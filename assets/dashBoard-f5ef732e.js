import"./main-49110b26.js";import{c as x,l as B,a as m,m as h}from"./alert-bd2070ce.js";function L(){M()}let s=new Array;const M=async()=>{B("訂單資料讀取中...");try{s=(await m.get(`${adminApi}/orders`,adminAuthz)).data.orders,g(s),u(s,y)}catch(e){h(e.response.data.message||`系統忙線中，
請稍候再試或洽詢客服人員`)}},F=async()=>{let t;try{const e=await m.delete(`${adminApi}/orders`,adminAuthz);t=e.status,s=e.data.orders,g(s),u(s,y)}catch(e){t=e.status,h(e.response.data.message||`系統忙線中，
請稍候再試或洽詢客服人員`)}return t},v=async t=>{let e;try{const r=await m.delete(`${adminApi}/orders/${t}`,adminAuthz);e=r.status,s=r.data.orders,g(s),u(s,y)}catch(r){e=r.status,h(r.response.data.message||`系統忙線中，
請稍候再試或洽詢客服人員`)}return e},P=async t=>{let r=s.filter(a=>a.id===t)[0].paid,n={data:{id:t,paid:!r}};B("訂單狀態更改中...");try{s=(await m.put(`${adminApi}/orders`,n,adminAuthz)).data.orders,g(s)}catch(a){h(a.response.data.message||`系統忙線中，
請稍候再試或洽詢客服人員`)}},j=t=>new Date(t*1e3).toLocaleDateString(),z=t=>{let e=new Object;return t.forEach(r=>{r.products.forEach(d=>{const{category:a,price:l,quantity:o}=d;e[a]?e[a]+=l*o:e[a]=l*o})}),Object.entries(e)},y=t=>{let e=new Object;return t.forEach(r=>{r.products.forEach(d=>{const{title:a,price:l,quantity:o}=d;e[a]?e[a]+=l*o:e[a]=l*o})}),I(Object.entries(e))},I=t=>{let e=new Array,r=0;return t.sort((n,d)=>d[1]-n[1]),t.forEach((n,d)=>{d<=2?e.push(n):r+=n[1]}),e.push(["其他",r]),e},N=document.querySelector(".orderPage-table"),C=N.querySelector("tbody"),g=t=>{const e=document.querySelector(".emptyStatusOrder");t.length===0?e.style.display="block":(e.style.display="none",C.innerHTML="",t.forEach(r=>{let{id:n,user:d,products:a,createdAt:l,paid:o}=r;R(n,d,a,l,o)}))},R=(t,e,r,n,d)=>{let a=document.createElement("tr");a.dataset.id=`${t}`;let l=document.createElement("td");l.textContent=`${t}`;let o=document.createElement("td"),E=document.createElement("p");E.textContent=`${e.name}`;let A=document.createElement("p");A.textContent=`${e.tel}`,o.appendChild(E),o.appendChild(A);let D=document.createElement("td");D.textContent=`${e.address}`;let S=document.createElement("td");S.textContent=`${e.email}`;let b=document.createElement("td");r.forEach((T,w)=>{let k=document.createElement("p");k.textContent=`${w+1}. ${T.title}x${T.quantity}`,b.appendChild(k)});let O=document.createElement("td"),q=j(n);O.textContent=`${q}`;let f=document.createElement("td");f.classList.add("orderStatus");let c=document.createElement("a");c.classList.add("orderStatusBtn"),c.href="#",d?(c.textContent="已處理",c.style.color="green"):(c.textContent="未處理",c.style.color="red"),f.appendChild(c);let $=document.createElement("td"),p=document.createElement("input");p.type="button",p.classList.add("delSingleOrder-Btn"),p.value="刪除",$.appendChild(p),a.appendChild(l),a.appendChild(o),a.appendChild(D),a.appendChild(S),a.appendChild(b),a.appendChild(O),a.appendChild(f),a.appendChild($),C.appendChild(a)},u=(t,e)=>{const r=document.querySelector(".emptyDataMsg"),n=document.querySelector("#chart");if(t.length===0)n.style.display="none",r.style.display="block";else{n.style.display="block",r.style.display="none";let d=e(t);c3.generate({bindto:"#chart",color:{pattern:["#DACBFF","#9D7FEA","#5434A7","#301E5F","#C3A5FF","#8465D6","#482B91","#271A4F"]},data:{type:"pie",columns:d}})}},H=document.querySelector(".discardAllBtn");H.addEventListener("click",t=>{t.preventDefault();const e={ask:"確定清除全部訂單嗎?",result:"訂單已全部清除"};x(e.ask,F,e.result)});C.addEventListener("click",t=>{t.preventDefault();let e=t.target,r=e.closest("tr");const n=r.dataset.id;if(e.classList.contains("delSingleOrder-Btn")){const d={ask:"確定刪除這筆訂單嗎?",result:"訂單已清除"};x(d.ask,()=>v(n),d.result)}e.classList.contains("orderStatusBtn")&&P(r.dataset.id)});const G=document.querySelector("#chartToggleBtn"),i=document.querySelector(".section-title h2");G.addEventListener("click",()=>{let t=["products","category"],e=["全品項營收比重","全產品類別營收比重"],r=i.dataset.chart;r===t[0]?(i.dataset.chart=t[1],i.textContent=e[1],u(s,z)):r===t[1]&&(i.dataset.chart=t[0],i.textContent=e[0],u(s,y))});L();
